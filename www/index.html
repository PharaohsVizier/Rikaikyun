<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<link href="./css/style.css" type="text/css" rel="stylesheet" />
		<link href="./css/screen.css" type="text/css" rel="stylesheet" />
		<link href="./css/ruby.css" type="text/css" rel="stylesheet" />
		<link href="./css/spinner.css" type="text/css" rel="stylesheet" />
		<link href="./css/fileselect/file.css" type="text/css" rel="stylesheet" />
        <title>Rikaikyun</title>
    </head>
    <body>
		<style class="dynamicStyle">
			.container img
			{
				max-height:100%;
			}
			.floater.bottom
			{
				bottom:0;
			}
			.dictionary-container
			{
				max-height:0;
			}
			.img-frame
			{
				width:0;
				height:0;
			}
			.container, .container *
			{
				line-height:1.5em;
			}
		</style>
		<div class="screen reader">
			<div class="scroller">
				<div class="container">
				</div>
			</div>
			<div class="statusBar">
				<div class="grid">
					<div class="col">
						<div class="progress">
							<div class="bar" style="width:0%"></div>
						</div>
					</div>
					<div class="col break"></div>
					<div class="col status">
						<span>1/1</span>
					</div>
					<div class="col break"></div>
				</div>
			</div>
			<div class="floater top">
				<div class="bar top">
					<div class="tab active" data-tab="word"><div class="pad"></div></div>
					<div class="tab" data-tab="name"><div div class="pad"></div></div>
					<div class="tab" data-tab="kanji"><div div class="pad"></div></div>
					<div class="resizer"></div><div class="close"></div>
				</div>
				<div class="dictionary-container">
					<div class="dictionary active" data-tab="word">
						<div class="empty">No words found.</div>
					</div>
					<div class="dictionary" data-tab="name">
						<div class="empty">No names found.</div>
					</div>
					<div class="dictionary" data-tab="kanji">
						<div class="empty">No kanji found.</div>
					</div>
					<div class="dictionary-not-ready">
						<span>Loading dictionaries...</span>
					</div>
				</div>
				<div class="bar bottom">
				</div>
			</div>
		</div>
		<div class="screen main menu">
			<div class="header">Menu</div>
			<div class="item openFile">Load file
				<input type="file"/>
			</div>
			<div class="item settings">Settings</div>
			<div class="item exit">Exit</div>
		</div>
		<div class="screen settings menu">
			<div class="header">General setting</div>
			<div class="item checkbox useGpu">Use GPU <i></i></div>
			<div class="item select openMethod">File opening method
				<i></i>
				<select>
					<option value="AJAX">AJAX</option>
					<option value="FileSystem">File system</option>
				</select>
			</div>
			<div class="header">Display setting</div>
			<div class="item slider padding">
				Margins:<span class="value"></span><br/>
				<input type="range" min="0" max="10" step="0.5"/>
			</div>
			<div class="item slider readerZoom">
				Text size:<span class="value"></span><br/>
				<input type="range" min="25" max="500" step="5"/>
			</div>
			<div class="item slider lineHeight">
				Line height:<span class="value"></span><br/>
				<input type="range" min="1" max="3" step="0.1"/>
			</div>
			<!--<div class="header">Hacks</div>
			<div class="item checkbox useGpuHack">Use GPU to force refresh <i></i></div>-->
		</div>
		<div class="screen file">
			<div class="files">
			</div>
		</div>
		<div class="screen loading active">
			<div class="message">
				<span>
					Loading, please wait...<br/><br/>
					<div class="spinner"></div>
				</span>
			</div>
		</div>
		<div class="blink" style="display:none">
		</div>
        <script type="text/javascript" src="cordova.js"></script>
		<script src="./rikaikun/data.js"></script>
		<script src="./js/jquery/jquery-1.8.3.min.js"></script>
		<script src="./js/jquery-ext/jquery-stylesheet.js"></script>
		<script src="./js/jquery-ext/jquery-absolutezoom.js"></script>
		<!-- <script src="./jquery-privatescroll.js"></script> -->
		<script src="./js/jquery-ext/jquery-fakescroll.js"></script>
		<script src="./js/jquery-ext/jquery-hasattributes.js"></script>
		<script src="./js/jquery-ext/jquery-removeattributes.js"></script>
		<script src="./js/fastclick/fastclick.js"></script>
		<!-- <script src="./js/getWordAtPoint.js"></script> -->
		<script src="./js/getCharacterAtPoint.js"></script>
		<script src="./js/textCrawler.js"></script>
		<script src="./js/flatterer.js"></script>
		<script src="./js/preloadStyleImages.js"></script>
		<script src="./js/fileSelect.js"></script>
		<script src="./js/htmlHelpers.js"></script>
		<script src="./js/fpsCount.js"></script>
		<script src="./js/xxhash/xxhash.lmd.js"></script>
		<script src="./js/settings.js"></script>
		<script src="./js/reader.js"></script>
		<!-- <script src="./js/encoding.js"></script> -->
        <script type="text/javascript">
			var deviceReady = false;
			function openExternalLink(a)
			{
				// this should prevent PhoneGap from opening external link in its WebView
				window.open(a.href);
				return false;
			}
			function run()
			{
				$(function()
				{
					preloadStyleImages.preload();
					FastClick.attach(document.body);
					//localStorage['edictPath'] = 'file:///storage/extSdCard/EDICT_Data/';
					//console.log(localStorage['edictPath']);
					var reader = new Reader();//dict);
					// Moved dictionary init to the end of reader init, to prevent it from blocking requests
					
					// Block context menu (makes the app run less buggy on chrome on desktop)
					$(document.body).on('contextmenu', function(e) { e.preventDefault(); });
					//reader.openFile('genji-01utf.html');
					//reader.openFile('test8.html');
					var lastFile = localStorage["lastFile"] || '';
					if (lastFile != '')
					{
						reader.openFile(lastFile);
						//console.log("Open: " + lastFile);
					}
					else
					{
						reader.selectScreen('main.menu');
					}
					//fpsCount.go();
				});
			}
			if (typeof cordova !== 'undefined' || typeof PhoneGap !== 'undefined' || typeof phonegap !== 'undefined')
			{
				document.addEventListener("deviceready", function()
				{
					deviceReady = true;
					run();
				}, false);
			}
			else
			{
				run();
			}
        </script>
    </body>
</html>
